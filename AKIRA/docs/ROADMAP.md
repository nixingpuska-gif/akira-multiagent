# AKIRA 2.0 -> IMBA AGENT - Дорожная карта

Статус: Фазы 1-12 реализованы (проверка 2026-01-26).
Post-roadmap: S13 Control Plane (deliberation + budget + retention) реализован (2026-01-27).
Post-roadmap: S14 Tooling Layer (ToolDefinition + Workspace + Terminal) реализован (2026-01-27).
Обновлено: 2026-01-26.

## Роли и ответственность
- Ассистент отвечает за проверку работы агентов и организацию их работы.
- Агент-кодер отвечает за внедрение и фикс багов по ТЗ.
- Агент-тестер отвечает за тест-план, запуск проверок и отчеты по качеству.

## Фаза 1: Фундамент (Уже сделано)
- Исправлены критические баги
- Базовая мультиагентная архитектура
- Orchestrator + Planner + Executor + Reflector
- Workers (Coder, Browser, Searcher)

## Фаза 2: RAG Память (1-2 недели)
**Приоритет:** ВЫСОКИЙ - основа для всех остальных функций.

### Улучшенный MemoryStore (3 дня)
- Расширить схему БД (episodes, patterns, projects)
- Добавить временные метки и контекст
- Индексация по типам памяти

### Векторный поиск (2 дня)
- Настроить ChromaDB коллекции
- Реализовать semantic search
- Кэширование частых запросов

### Индексация проектов (2 дня)
- Сканирование файлов проекта
- Извлечение метаданных (tech stack, структура)
- Автоматическая индексация при изменениях

### Компрессия контекста (1 день)
- Сжатие длинных диалогов
- Выделение ключевых фактов
- Приоритизация важной информации

**Файлы:**
- `core/memory/store.py` - расширить
- `core/memory/indexer.py` - создать
- `core/memory/retriever.py` - создать
- `core/memory/compressor.py` - создать

> Примечание: файлы указаны как целевые точки реализации. Если файл уже существует, проверить соответствие задачам и доработать.

## Фаза 3: Эпизодическая Память (1 неделя)
**Приоритет:** ВЫСОКИЙ - учится на опыте.

### Episode Storage (2 дня)
- Структура для хранения эпизодов
- Связи между эпизодами
- Причинно-следственные цепочки

### Pattern Recognition (3 дня)
- Поиск повторяющихся паттернов
- Классификация типов задач
- Извлечение успешных стратегий

### Temporal Reasoning (2 дня)
- Анализ последовательности событий
- Предсказание на основе истории
- Контекстуальный поиск

**Файлы:**
- `core/memory/episodic.py` - создать
- `core/memory/patterns.py` - создать

## Фаза 4: Мета-Обучение (1 неделя)
**Приоритет:** СРЕДНИЙ - оптимизация стратегий.

### Strategy Tracking (2 дня)
- Логирование используемых стратегий
- Метрики успеха/неудачи
- A/B тестирование подходов

### Strategy Selection (3 дня)
- Анализ эффективности стратегий
- Адаптивный выбор под задачу
- Комбинирование стратегий

### Learning Rate Optimization (2 дня)
- Скорость адаптации
- Баланс exploration/exploitation

**Файлы:**
- `core/learning/meta_learner.py` - создать
- `core/learning/strategies.py` - создать

## Фаза 5: Параллельное Мышление (1 неделя)
**Приоритет:** СРЕДНИЙ - повышение качества решений.

### Diverse Reasoning (3 дня)
- Запуск агентов с разными промптами
- Параллельное выполнение
- Сбор результатов

### Meta-Judge (2 дня)
- Оценка качества решений
- Выбор лучшего результата
- Синтез решений

### Resource Management (2 дня)
- Ограничение параллельных запросов
- Балансировка нагрузки
- Таймауты и fallback
- Стабильный формат ответа parallel_reasoning при отсутствии router (error + best + best_text + candidates)

**Файлы:**
- `core/reasoning/parallel.py` - создать
- `core/reasoning/judge.py` - создать

## Фаза 6: Предиктивное Планирование (1 неделя)
**Приоритет:** ВЫСОКИЙ - избегание ошибок.

### World Model (3 дня)
- Модель предсказания результатов
- Обучение на истории
- Оценка вероятности успеха

### Simulation Engine (2 дня)
- Симуляция действий
- Оценка рисков
- Поиск альтернатив

### Plan Optimization (2 дня)
- Корректировка плана
- Минимизация рисков
- Оптимизация по времени/ресурсам

**Файлы:**
- `core/planning/predictive.py` - создать
- `core/planning/simulator.py` - создать
- `core/planning/world_model.py` - создать

## Фаза 7: Автоматическое Создание Инструментов (1 неделя)
**Приоритет:** СРЕДНИЙ - расширение возможностей.

### Tool Generator (3 дня)
- Генерация кода инструмента
- Валидация и тестирование
- Документация

### Dynamic Registration (2 дня)
- Регистрация в runtime
- Обновление списка инструментов
- Версионирование

### Tool Library (2 дня)
- Сохранение созданных инструментов
- Переиспользование
- Категоризация

**Файлы:**
- `core/tools/creator.py` - создать
- `core/tools/validator.py` - создать
- `core/tools/library.py` - создать

## Фаза 8: Кросс-Проектная Память (1 неделя)
**Приоритет:** СРЕДНИЙ - накопление экспертизы.

### Project Indexing (3 дня)
- Сканирование всех проектов
- Извлечение паттернов
- Метаданные (tech stack, архитектура)

### Pattern Extraction (2 дня)
- Поиск повторяющихся решений
- Классификация паттернов
- Оценка эффективности

### Cross-Project Search (2 дня)
- Поиск по всем проектам
- Фильтрация по контексту
- Ранжирование результатов

**Файлы:**
- `core/memory/cross_project.py` - создать
- `core/memory/pattern_extractor.py` - создать

## Фаза 9: Самодиагностика и Восстановление (1 неделя)
**Приоритет:** ВЫСОКИЙ - надежность 24/7.

### Health Monitoring (2 дня)
- Мониторинг памяти, CPU, ошибок
- Метрики производительности
- Алерты

### Auto-Healing (3 дня)
- Обнаружение проблем
- Автоматическое исправление
- Откат изменений

### Logging & Analytics (2 дня)
- Детальное логирование
- Анализ трендов
- Предсказание проблем

**Файлы:**
- `core/health/monitor.py` - создать
- `core/health/healer.py` - создать
- `core/health/analytics.py` - создать

## Фаза 10: Адаптивные Промпты (1 неделя)
**Приоритет:** ВЫСОКИЙ - постоянное улучшение.

### Prompt Tracking (2 дня)
- Логирование промптов и результатов
- Метрики эффективности
- Корреляция с успехом

### Prompt Optimization (3 дня)
- Генерация улучшенных промптов
- A/B тестирование
- Автоматическое обновление

### Prompt Library (2 дня)
- Библиотека лучших промптов
- Версионирование
- Откат к предыдущим версиям

**Файлы:**
- `core/prompts/adaptive.py` - создать
- `core/prompts/optimizer.py` - создать
- `core/prompts/library.py` - создать

## Фаза 11: Самомодификация Кода (2 недели)
**Приоритет:** НИЗКИЙ - самая сложная функция.

### Code Analysis (4 дня)
- Анализ собственного кода
- Поиск узких мест
- Обнаружение багов

### Patch Generation (4 дня)
- Генерация исправлений
- Тестирование в sandbox
- Валидация безопасности

### Safe Application (3 дня)
- Применение патчей
- Откат при проблемах
- Версионирование кода

### Approval System (3 дня)
- Запрос одобрения пользователя
- Объяснение изменений
- История модификаций

**Файлы:**
- `core/self_mod/analyzer.py` - создать
- `core/self_mod/patcher.py` - создать
- `core/self_mod/sandbox.py` - создать
- `core/self_mod/approval.py` - создать

## Фаза 12: Распределенное Выполнение (1 неделя)
**Приоритет:** НИЗКИЙ - масштабирование.

### Node Management (3 дня)
- Регистрация узлов (local, cloud, GPU)
- Мониторинг доступности
- Балансировка нагрузки

### Task Distribution (2 дня)
- Анализ требований задачи
- Выбор оптимального узла
- Передача задачи

### Result Aggregation (2 дня)
- Сбор результатов
- Обработка ошибок
- Retry логика

**Файлы:**
- `core/distributed/executor.py` - создать
- `core/distributed/nodes.py` - создать
- `core/distributed/balancer.py` - создать

## Итоговая таблица

| Фаза | Функция | Приоритет | Время | Зависимости |
|---|---|---|---|---|
| 2 | RAG Память | ВЫСОКИЙ | 1-2 нед | - |
| 3 | Эпизодическая Память | ВЫСОКИЙ | 1 нед | Фаза 2 |
| 4 | Мета-Обучение | СРЕДНИЙ | 1 нед | Фаза 3 |
| 5 | Параллельное Мышление | СРЕДНИЙ | 1 нед | - |
| 6 | Предиктивное Планирование | ВЫСОКИЙ | 1 нед | Фаза 3 |
| 7 | Создание Инструментов | СРЕДНИЙ | 1 нед | - |
| 8 | Кросс-Проектная Память | СРЕДНИЙ | 1 нед | Фаза 2 |
| 9 | Самодиагностика | ВЫСОКИЙ | 1 нед | - |
| 10 | Адаптивные Промпты | ВЫСОКИЙ | 1 нед | Фаза 3 |
| 11 | Самомодификация | НИЗКИЙ | 2 нед | Все |
| 12 | Распределенное Выполнение | НИЗКИЙ | 1 нед | - |

**Общее время:** 10-12 недель.

## Рекомендуемый порядок
1. Фаза 2 (RAG) -> Фаза 3 (Эпизоды) -> Фаза 9 (Самодиагностика)
2. Фаза 6 (Предиктивное) -> Фаза 10 (Адаптивные промпты)
3. Фаза 4 (Мета-обучение) -> Фаза 5 (Параллельное)
4. Фаза 7 (Инструменты) -> Фаза 8 (Кросс-проект)
5. Фаза 11 (Самомодификация) -> Фаза 12 (Распределенное)

## Приветственный промпт для нового чата

```
# КОНТЕКСТ: Проект AKIRA 2.0 - Автономный AI Агент

## Что уже сделано

### Фаза 1: Критические фиксы (готово)
Исправлены основные баги в проекте C:\Users\Nicita\Desktop\AKIRA:

1. **core/prompts.py** - добавлен динамический контекст:
   - Функция `get_system_context()` с информацией об ОС, режиме, директории
   - Расширенный `BASE_SYSTEM_PROMPT` с инструкциями
   - Детальный `TOOL_INSTRUCTIONS` с правилами использования путей

2. **core/graph_agent.py** - улучшена логика агента:
   - Добавлен лимит итераций (MAX_ITERATIONS=15)
   - Retry логика для JSON (MAX_JSON_RETRIES=3)
   - Передача режима (safe/full) в промпт
   - Улучшенный `_try_json()` с поддержкой markdown блоков
   - Обработка ошибок в tool_node и delegate_node

3. **core/tools/registry.py** - исправлены пути:
   - Функция `get_default_screenshot_path()` для OS-специфичных путей
   - Правильные Windows пути в temp директории

### Фаза 2: Мультиагентная архитектура (готово)
Создана новая структура `core/agents/`:

1. **base.py** - базовый класс:
   - `AgentContext` - контекст выполнения (ОС, режим, инструменты)
   - `AgentResult` - результат работы агента
   - `BaseAgent` - абстрактный класс с retry логикой

2. **orchestrator.py** - главный координатор:
   - Управляет всеми подагентами
   - Цикл выполнения с лимитом итераций
   - Делегирование задач

3. **planner.py** - планировщик:
   - Разбивает сложные задачи на шаги
   - Генерирует план выполнения

4. **executor.py** - исполнитель:
   - Выполняет инструменты
   - Поддержка параллельного выполнения

5. **reflector.py** - анализатор:
   - Анализирует ошибки
   - Предлагает улучшения
   - Сохраняет уроки в память

### Фаза 3: Workers (готово)
Созданы специализированные workers в `core/agents/workers/`:

1. **coder.py** - интеграция с Codex CLI:
   - Делегирование задач программирования
   - Запуск через subprocess

2. **browser.py** - веб-автоматизация:
   - Использует Playwright инструменты
   - Итеративное выполнение веб-задач

3. **searcher.py** - поиск:
   - Веб-поиск через браузер
   - Локальный поиск по файлам

### Интеграция (готово)
**core/runtime.py** обновлен:
- Импорты новых агентов
- Метод `_init_orchestrator()` для инициализации
- Регистрация всех подагентов

## Текущая архитектура

AgentRuntime
├── GraphAgent (текущий, работает)
└── OrchestratorAgent (новый, готов)
├── PlannerAgent
├── ExecutorAgent
└── ReflectorAgent
└── Workers
   ├── CoderWorker
   ├── BrowserWorker
   └── SearcherWorker

## Что нужно сделать дальше

### Приоритет 1: RAG Память (1-2 недели)
Улучшить `core/memory/` для долгосрочной памяти:
- Расширить MemoryStore (episodes, patterns, projects)
- Настроить ChromaDB для semantic search
- Создать indexer.py для индексации проектов
- Создать retriever.py для умного поиска
- Создать compressor.py для сжатия контекста

### Приоритет 2: Эпизодическая Память (1 неделя)
Создать `core/memory/episodic.py`:
- Хранение последовательности событий
- Поиск паттернов в задачах
- Причинно-следственные связи

### Приоритет 3: Самодиагностика (1 неделя)
Создать `core/health/`:
- monitor.py - мониторинг здоровья системы
- healer.py - автоматическое исправление проблем
- analytics.py - анализ трендов

### Приоритет 4: Адаптивные промпты (1 неделя)
Создать `core/prompts/adaptive.py`:
- Отслеживание эффективности промптов
- Автоматическое улучшение
- A/B тестирование

## Полная дорожная карта

См. детальную дорожную карту с 12 фазами:
1. Фундамент (готово)
2. RAG Память (высокий)
3. Эпизодическая Память (высокий)
4. Мета-Обучение (средний)
5. Параллельное Мышление (средний)
6. Предиктивное Планирование (высокий)
7. Создание Инструментов (средний)
8. Кросс-Проектная Память (средний)
9. Самодиагностика (высокий)
10. Адаптивные Промпты (высокий)
11. Самомодификация (низкий)
12. Распределенное Выполнение (низкий)

## Технический стек
- Python 3.11
- LangGraph - граф агентов
- aiogram - Telegram бот
- FastAPI - веб-интерфейс
- Playwright - браузер
- ChromaDB - векторный поиск
- Mem0 - долгосрочная память
- SQLite - локальная БД

## Конфигурация
Проект: `C:\Users\Nicita\Desktop\AKIRA`
Запуск: `python -m app.main`
Режимы: safe (по умолчанию) / full (полный доступ)

## Следующий шаг
Начни с реализации RAG памяти - это фундамент для всех остальных функций.
```
